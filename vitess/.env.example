# =====================================================
# Vitess Configuration Environment Variables
# =====================================================
#
# QUICK START:
# 1. Copy this file to .env: cp .env.example .env
# 2. Start the cluster: docker-compose up -d
# 3. Initialize cluster (REQUIRED): ./init-cluster.sh
#    ⚠️  IMPORTANT: Always run init-cluster.sh after:
#       - First time setup
#       - Running 'docker-compose down -v' (which deletes all data)
#       - Any situation where tablets are NOT_SERVING
# 4. Access:
#    - MySQL: localhost:15306
#    - VTAdmin Web UI: http://localhost:14201
#    - VTAdmin API: http://localhost:14200/api/clusters
#    - VTOrc (failover): http://localhost:13000/debug/status
#    - VTGate UI: http://localhost:15099/debug/status
#    - VTCtld UI: http://localhost:15000/debug/status
#
# -----------------------------------------------------
# Vitess Version
# Note: Vitess doesn't have official ARM64 images yet
# Using AMD64 with Rosetta emulation on Apple Silicon
# -----------------------------------------------------
VITESS_VERSION=latest

# -----------------------------------------------------
# ETCD Configuration
# ETCD supports ARM64 natively
# -----------------------------------------------------
ETCD_VERSION=v3.5.11
ETCD_CLUSTER_TOKEN=etcd-cluster
ETCD_INITIAL_CLUSTER_STATE=new
# ETCD Ports
ETCD1_CLIENT_PORT=2379
ETCD1_PEER_PORT=2380
ETCD2_CLIENT_PORT=2379
ETCD2_PEER_PORT=2380
ETCD3_CLIENT_PORT=2379
ETCD3_PEER_PORT=2380

# -----------------------------------------------------
# Topology Configuration
# -----------------------------------------------------
TOPO_IMPLEMENTATION=etcd2
TOPO_GLOBAL_SERVER=etcd1:2379
TOPO_GLOBAL_ROOT=vitess/global
TOPOLOGY_FLAGS=--topo-implementation etcd2 --topo-global-server-address etcd1:2379 --topo-global-root vitess/global

# -----------------------------------------------------
# Cell Configuration
# -----------------------------------------------------
CELL=test
CELLS_TO_WATCH=test

# -----------------------------------------------------
# External MySQL Database Configuration
# -----------------------------------------------------
EXTERNAL_DB=0
DB_HOST=host.docker.internal
DB_PORT=3306
DB_USER=root
DB_PASS=root
DB_CHARSET=

# -----------------------------------------------------
# Keyspace Configuration
# -----------------------------------------------------
# Test Keyspace
TEST_KEYSPACE=test_keyspace
TEST_KEYSPACE_VSCHEMA=test_keyspace_vschema.json
TEST_KEYSPACE_SCHEMA=test_keyspace_schema_file.sql
# Lookup Keyspace
LOOKUP_KEYSPACE=lookup_keyspace
LOOKUP_KEYSPACE_VSCHEMA=lookup_keyspace_vschema.json
LOOKUP_KEYSPACE_SCHEMA=lookup_keyspace_schema_file.sql
# All Keyspaces (space-separated)
KEYSPACES=test_keyspace lookup_keyspace

# -----------------------------------------------------
# Shard Configuration
# -----------------------------------------------------
# Test Keyspace Shards
TEST_KEYSPACE_SHARD_1=-80
TEST_KEYSPACE_SHARD_2=80-
# Lookup Keyspace Shard
LOOKUP_KEYSPACE_SHARD=-

# -----------------------------------------------------
# VTGate Configuration
# -----------------------------------------------------
VTGATE_WEB_PORT=15099
VTGATE_GRPC_PORT=15999
VTGATE_MYSQL_PORT=15306
VTGATE_MYSQL_AUTH=none
VTGATE_NORMALIZE_QUERIES=true
TABLET_TYPES_TO_WAIT=PRIMARY,REPLICA,RDONLY

# -----------------------------------------------------
# VTCtld Configuration
# -----------------------------------------------------
VTCTLD_WEB_PORT=15000
VTCTLD_GRPC_PORT=15999
VTCTLD_SERVICE_MAP=grpc-vtctl,grpc-vtctld
# Backup Configuration
BACKUP_STORAGE_IMPLEMENTATION=file
BACKUP_STORAGE_ROOT=/vt/vtdataroot/backups

# -----------------------------------------------------
# VTOrc Configuration
# -----------------------------------------------------
VTORC_WEB_PORT=13000
VTORC_CLUSTERS_TO_MONITOR=test

# -----------------------------------------------------
# VTTablet Common Configuration
# -----------------------------------------------------
VTTABLET_WEB_PORT=8080
VTTABLET_GRPC_PORT=15999
VTTABLET_SERVICE_MAP=grpc-tabletmanager,grpc-queryservice,grpc-updatestream,grpc-throttler
VTTABLET_HEALTH_CHECK_INTERVAL=5s
# Health Check Configuration
HEALTHCHECK_INTERVAL=30s
HEALTHCHECK_TIMEOUT=10s
HEALTHCHECK_RETRIES=15

# -----------------------------------------------------
# VTTablet 101 (Test Keyspace Shard -80 Primary)
# -----------------------------------------------------
VTTABLET101_ID=101
VTTABLET101_KEYSPACE=test_keyspace
VTTABLET101_SHARD=-80
VTTABLET101_ROLE=primary
VTTABLET101_HOST=vttablet101
VTTABLET101_WEB_PORT=15101

# -----------------------------------------------------
# VTTablet 102 (Test Keyspace Shard -80 Replica)
# -----------------------------------------------------
VTTABLET102_ID=102
VTTABLET102_KEYSPACE=test_keyspace
VTTABLET102_SHARD=-80
VTTABLET102_ROLE=replica
VTTABLET102_HOST=vttablet102
VTTABLET102_WEB_PORT=15102

# -----------------------------------------------------
# VTTablet 201 (Test Keyspace Shard 80- Primary)
# -----------------------------------------------------
VTTABLET201_ID=201
VTTABLET201_KEYSPACE=test_keyspace
VTTABLET201_SHARD=80-
VTTABLET201_ROLE=primary
VTTABLET201_HOST=vttablet201
VTTABLET201_WEB_PORT=15201

# -----------------------------------------------------
# VTTablet 202 (Test Keyspace Shard 80- Replica)
# -----------------------------------------------------
VTTABLET202_ID=202
VTTABLET202_KEYSPACE=test_keyspace
VTTABLET202_SHARD=80-
VTTABLET202_ROLE=replica
VTTABLET202_HOST=vttablet202
VTTABLET202_WEB_PORT=15202

# -----------------------------------------------------
# VTTablet 301 (Lookup Keyspace Primary)
# -----------------------------------------------------
VTTABLET301_ID=301
VTTABLET301_KEYSPACE=lookup_keyspace
VTTABLET301_SHARD=-
VTTABLET301_ROLE=primary
VTTABLET301_HOST=vttablet301
VTTABLET301_WEB_PORT=15301

# -----------------------------------------------------
# VTTablet 302 (Lookup Keyspace Replica)
# -----------------------------------------------------
VTTABLET302_ID=302
VTTABLET302_KEYSPACE=lookup_keyspace
VTTABLET302_SHARD=-
VTTABLET302_ROLE=replica
VTTABLET302_HOST=vttablet302
VTTABLET302_WEB_PORT=15302

# -----------------------------------------------------
# Schema Load Configuration
# -----------------------------------------------------
# Lookup Keyspace Schema Load
SCHEMALOAD_LOOKUP_TARGET_TAB=test-0000000301
SCHEMALOAD_LOOKUP_SLEEP_TIME=15
# Test Keyspace Schema Load
SCHEMALOAD_TEST_TARGET_TAB=test-0000000101
SCHEMALOAD_TEST_SLEEP_TIME=15

# -----------------------------------------------------
# Network Configuration
# -----------------------------------------------------
NETWORK_NAME=shared

# -----------------------------------------------------
# Logging Configuration
# -----------------------------------------------------
LOG_TO_STDERR=true

# -----------------------------------------------------
# Scripts and Configuration Paths
# -----------------------------------------------------
# These paths are relative to the mounted volume in containers
SCRIPTS_PATH=/script/configs/compose
CONFIG_PATH=/script/configs/compose/config
SQL_PATH=/script/sql
# Script Files
VTTABLET_SCRIPT=vttablet-up.sh
SCHEMALOAD_SCRIPT=schemaload.sh
VTORC_SCRIPT=vtorc-up.sh
EXTERNALDB_VREPLICATION_SCRIPT=externaldb_vreplication.sh
SET_KEYSPACE_DURABILITY_SCRIPT=set_keyspace_durability_policy.sh
RUN_FOREVER_SCRIPT=run-forever.sh

# -----------------------------------------------------
# Durability Policy
# -----------------------------------------------------
# Options: none, semi_sync, cross_cell
DURABILITY_POLICY=none
