version: '3.8'
networks:
    kafka_network:

volumes:
  kafka:
    driver: local

services:
  zookeeper:
    image: quay.io/debezium/zookeeper:${DEBEZIUM_VERSION}
    ports:
     - 2181:2181
     - 2888:2888
     - 3888:3888
    networks:
      - kafka_network

  kafka:
    image: quay.io/debezium/kafka:${DEBEZIUM_VERSION}
    ports:
     - 9092:9092
    links:
     - zookeeper
    environment:
     - BROKER_ID=1
     - HOST_NAME=kafka
     - ADVERTISED_LISTENERS=PLAINTEXT://kafka:9092
     - ZOOKEEPER_CONNECT=zookeeper:2181
    networks:
      - kafka_network

  # Test with internal mysql
  # mysql:
  #   image: quay.io/debezium/example-mysql:${DEBEZIUM_VERSION}
  #   ports:
  #    - 3306:3306
  #   environment:
  #    - MYSQL_ROOT_PASSWORD=debezium
  #    - MYSQL_USER=mysqluser
  #    - MYSQL_PASSWORD=mysqlpw
  #   networks:
  #     - kafka_network

  connect:
    image: quay.io/debezium/connect:${DEBEZIUM_VERSION}
    container_name: connect
    ports:
     - 8083:8083
     - 5005:5005
    links:
     - kafka
    #  - mysql
    environment:
     - GROUP_ID=1
     - CONFIG_STORAGE_TOPIC=thep200_connect_configs
     - OFFSET_STORAGE_TOPIC=thep200_connect_offsets
     - CONNECT_KEY_CONVERTER=org.apache.kafka.connect.json.JsonConverter
     - CONNECT_VALUE_CONVERTER=org.apache.kafka.connect.json.JsonConverter
     - CONNECT_KEY_CONVERTER_SCHEMAS_ENABLE=false
     - CONNECT_VALUE_CONVERTER_SCHEMAS_ENABLE=false
     - BOOTSTRAP_SERVERS=kafka:9092
    #  - HOST_NAME= api bind address
    #  - ADVERTISED_LISTENERS=PLAINTEXT://connect:8083
    # volumes:
    #  - ./debezium-connector-jdbc-mysql:/kafka/connect/debezium-connector-jdbc
    networks:
      - kafka_network

  uikafka:
    image: provectuslabs/kafka-ui:latest
    restart: unless-stopped
    container_name: uikafka
    ports:
      - '8080:8080'
    environment:
      - KAFKA_CLUSTERS_0_NAME=Local
      - KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS=kafka:9092
      - DYNAMIC_CONFIG_ENABLED=true
      - KAFKA_CLUSTERS_0_AUDIT_TOPICAUDITENABLED=true
      - KAFKA_CLUSTERS_0_AUDIT_CONSOLEAUDITENABLED=true
      - DYNAMIC_CONFIG_ENABLED=true
      - KAFKA_CLUSTERS_0_KAFKACONNECT_0_NAME=connect
      - KAFKA_CLUSTERS_0_KAFKACONNECT_0_ADDRESS=http://connect:8083
    networks:
      - kafka_network
